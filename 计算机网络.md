# 第一章 

## 一、概念、组成、功能、分类
* 计算机网络：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。
* 计算机网络是互连的、自治的计算机集合：互连-互联互通通过通信链路；自治-无主从关系
* 计算机网络的功能：
    1. $\color{red}{数据通信}$（连通性）
    2. $\color{red}{资源共享}$：硬件、软件、数据
    3. 分布式处理：多台计算机各自承担同一工作任务的不同部分 Hadoop平台
    4. 提高可靠性
    5. 负载均衡
* 计算机网络的组成
    * 组成部分：硬件、软件、协议
    * 工作方式：边缘部分：用户直接使用，CS方式和P2P方式；核心部分：为边缘部分服务
    * 功能组成：数据通信子网：实现数据通信；资源子网：实现资源共享/数据处理
* 计算机网络的分类
    1. 按分布范围分：广域网WAN；城域网MAN；局域网LAN；个人区域网PAN
    2. 按使用者分：公用网；专用网
    3. 按交换技术分：电路交换；报文交换；分组交换
    4. 按拓扑结构分：总线型；星型；环型；网状型
    5. 按传输技术分：广播式网络：共享公共通信信道；点对点网络：使用分组存储转发和路由选择机制

## 二、标准化工作及其相关组织
* 标准化工作：要实现不同的硬、软件之间相互连通，必须遵从统一的标准
* 标准的分类：
    1. 法定标准：由权威机构制定的正式的、合法的标准（OSI)
    2. 事实标准：某些公司的产品在竞争中占据了主流，时间长了，这些产品中的协议和技术就成了标准（TCP/IP）
* RFC(Request For Comments)：因特网标准的形式。RFC要上升为因特网正式标准的四个阶段：
    1. 因特网草案：这个阶段还不是RFC文档
    2. 建议标准：从这个阶段开始成为RFC文档
    3. 草案标准：从2011年就取消了
    4. 因特网标准
* 标准化工作的相关组织
    1. 国际标准化组织ISO：OSI参考模型、HDLC协议
    2. 国际电信联盟ITU：制定通信规则
    3. 国际电气电子工程师协会IEEE：学术机构、IEEE802系列标准、5G
    4. Internet工程任务组IETF：负责因特网相关标准的制定

## 三、速率相关的性能指标
* 速率：$\color{red}{数据率}$或称$\color{red}{数据传输率}$或$\color{red}{比特率}$。连接在计算机网络上的主机在数字信道上传送数据位数的速率。单位有：b/s, kb/s, Mb/s, Gb/s, Tb/s ($10^{-3}$的换算关系)
* 带宽：“带宽”原本指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹(Hz)。计算机网络中，带宽用来表示网络的通信线路传送数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。单位是“比特每秒”
    * 链路带宽：主机在1us内可向链路发送的数据量
* 吞吐量：在$\color{red}{单位时间内}$内通过$\color{red}{某个网络（或信道、接口）}$的数据量。单位b/s, kB/s, Mb/s等。吞吐量受网络的带宽或网络的额定速率的限制

### 时延：
* 指数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需的时间。也叫延迟或迟延。单位是s。
1. 发送时延（传输时延）：从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间；$\color{blue}{公式}$：$发送时延=\frac{数据长度}{信道带宽}$其中信道带宽就是发送速率。
    * 假定分组以先到先服务方式传输——这在分组交换网中是常见的方式，仅当所有已经到达的分组被传输后，才能传输刚到达的分组。用L比特表示该分组的长度，用$R bps$即$b / s$表示从路由器A到路由器B的传输链路速率。例如，对于一条$10Mbps$的以太网链路，速率$R = 10Mbps$；对于$100Mbps$的以太网链路，速率$R = 100Mbps$，传输时延是$L/R$。这是将所有分组的比特推向链路（即传输，或者说发射）所需要的时间。实际的传输时延通常是在毫秒到微秒量级
2. 传播时延：取决于电磁波传播速度和链路长度（实际应用中都算$2*10^{8}m/s$；$\color{blue}{公式}$：$传播时延=\frac{信道长度}{电磁波在信道上的传播速率}$
    * 一旦一个比特被推向链路，该比特需要向路由器B传播。从该链路的起点到路由器B传播所需要的时间是传播时延
3. 排队时延：等待输出/输入链路可用的时间。
4. 处理时延：检错
* 时延带宽积：时延带宽积=传播时延✖️带宽。单位bit，是一个描述信息量的信息。又称$\color{red}{以比特为单位的链路长度}$即某段链路现在有多少比特
* 往返时延RTT：从发送方发送数据开始，到发送方收到接收方的确认（接收方收到数据后立即发送确认），总共经历的时延。RTT越大，在收到确认之前，可以发送的数据越多
    * RTT包括：往返传播时延=传播时延 * 2 和 末端处理时间
* 利用率：
    1. 信道利用率：$\frac{有数据通过的时间}{（有+无）数据通过的时间}$
    2. 网络利用率：信道利用率加权平均值

#### 排队时延和丢包
* 节点时延最为复杂的成分是排队时延
* 在队列中，当分组在链路上等待传输时，它经受排队时延。一个特定分组的排队时延长度将取决于先期到达的正在排队等待向链路传输的分组数量。如果该队列是空的，并且当且没有其他分组正在传输，则该分组的排队时延为0.另一方面，如果流量很大，并且许多其他分组也在等待传输，该排队时延将很长。
* 什么时候排队时延大，什么时候又不大？该问题的答案很大程度取决于流量到达该队列的速率、链路的传输速率和到达流量的性质，即流量是周期性到达还是以突发形式到达。
* 丢包：在现实中，一条链路前的队列只有有限的容量，尽管排队容量极大地依赖于路由器设计和成本。因为该排队容量是有限的，随着流量强度接近1，排队时延并不真正趋向无穷大。相反，到达的分组将发现一个满的队列。由于没有地方存储这个分组，路由器将丢弃该分组，即该分组将会丢失

## 四、分层结构、协议、接口和服务
* 例：发送文件前要完成的工作
    1. 发起通信的计算机必须将数据通信的通路进行$\color{red}{激活}$
    2. 要告诉网络如何识别目的主机。
    3. 发起通信的计算机要查明目的主机是否开机，并且与网络连接正常。
    4. 发起通信的计算机要弄清楚，对方计算机中文件管理程序是否已经做好准备工作
    5. 确保差错和意外可以解决

* 分层结构：
    * 分层的基本原则：
        1. 各层之间相互$\color{red}{独立}$，每层只实现一种相对独立的功能。
        2. 每层之间$\color{red}{界面自然清晰}$，易于理解，相互交流尽可能少。
        3. 结构上可分割开。每层都采用$\color{red}{最合适的技术}$来实现。
        4. 保持$\color{red}{下层}$对$\color{red}{上层}$的独立性，上层单独使用下层提供的服务
        5. 整个分层结构应该能促进标准化工作
    * 实体：第n层中的活动元素称为$\color{red}{n层实体}$。同一层的实体叫$\color{red}{对等实体}$
    * 协议：为进行网络中的对等实体数据交换而建立的规则、标准或约定称为网络协议
        * 语法：规定传输数据的格式
        * 语义：规定所要完成的功能
        * 同步（时序）：规定各种操作的顺序
    * 接口（访问服务点SAP）：上层使用下层服务的入口
    * 服务：下层为相邻上层提供的功能调用
    * SDU服务数据单元：为完成用户所要求的功能而应传送的数据
    * PCI协议控制信息：控制协议操作的信息
    * PDU协议数据单元：对等层次之间传送的数据单位。PCI+SDU=PDU
    ![](https://qiancijun-images.oss-cn-beijing.aliyuncs.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84.png)

    * 小结：
        1. 网络体系结构是从$\color{red}{功能}$上描述计算机网络结构
        2. 计算机网络体系结构简称网络体系结构是$\color{red}{分层结构}$
        3. 每层遵循某个/些$\color{red}{网络协议}$以完成本层结构
        4. $\color{red}{计算机网络体系结构}$是计算机网络的$\color{red}{各层及其协议}$的集合
        5. 第n层在向第n-1层提供服务时，此服务不仅包含第n层本身的功能，还包含下层服务提供的功能
        6. 仅仅在$\color{red}{相邻层间有接口}$，且所提供服务的具体实现细节对上一层完全屏蔽
        7. 体系结构式$\color{red}{抽象}$的，而实现是指能运行的一些软件和硬件

## 五、OSI参考模型
### 7层OSI参考模型
OSI参考模型：目的是支持$\color{red}{异构网络系统}$的互联互通。国际标准化组织（ISO）于1984年提出开放系统互连（OSI）参考模型。OSI在理论上是成功的，但是市场上失败的。
* OSI（七层）：
    1. 物理层：在$\color{red}{物理媒体}$上实现比特流的$\color{red}{透明传输}$。物理层传输单位是$\color{red}{比特}$
        * 透明传输：指不管所传输数据是什么样的比特组合，都应当能够在链路上传送。传输介质不是物理层
        * 功能一：定义接口特性
        * 功能二：定义传输模式：单工、半双工、双工
        * 功能三：定义传输速率
        * 功能四：比特同步
        * 功能五：比特编码
        * 主要协议：Rj45、802.3
    2. 数据链路层：把网络层传下来的数据报$\color{red}{组装成帧}$。数据链路层的传输单位是$\color{red}{帧}$
        * 主要功能：在不可靠的物理线路上进行数据的可靠传输
        * 功能一：成帧（定义帧的开始和结束）
        * 功能二：差错控制：帧错 + 位错
        * 功能三：流量控制
        * 功能四：访问（接入）控制：控制对信道的访问
        * 主要协议：SDLC、HDLC、PPP、STP
        * IEEE标准将该层又分为$\color{blue}{介质访问控制层(MAC)}$和$\color{blue}{逻辑链路控制层(LLC)}$
    3. 网络层：主要任务是把$\color{red}{分组}$从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是$\color{red}{数据报}$
        * 功能一：路由选择
        * 功能二：流量控制
        * 功能三：差错控制
        * 功能四：拥塞控制：若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞
        * 主要协议：IP、IPX、UCMP、IGMP、ARP、RARP、OSPF
    4. 传输层：负责主机中$\color{red}{两个进程}$的通信，即$\color{red}{端到端}$的通信。传输单位是$\color{red}{报文段}$或用户数据报
        * 功能一：可靠传输、不可靠传输
        * 功能二：差错控制
        * 功能三：流量控制
        * 功能四：复用分用
            * 复用：多个应用层进程可同时使用下面运输层的服务
            * 分用：运输层把收到的信息分别交付给上面应用层中相应的进程
        * 主要协议：TCP(可靠的)/UDP(不可靠的)
    5. 会话层：向表示层实体/用户进程提供$\color{red}{建立连接}$并在连接上$\color{red}{有序}$的$\color{red}{传输}$数据。这是会话也是$\color{red}{建立同步}$
        * 功能一：建立、管理、终止会话
        * 功能二：使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步
        * 主要协议：ADSP、ASP
    6. 表示层：用于处理在两个通信系统中交换信息的表示方式（语法和语义）
        * 功能一：数据格式变换
        * 功能二：数据加密解密
        * 功能三：数据压缩和恢复
    7. 应用层：所有能和用户交互产生网络流量的程序，典型应用层服务：文件传输（FTP），电子邮件（SMTP），万维网（HTTP）
    
### 4层TCP/IP参考模型
* TCP/IP协议简介：TCP/IP实际上是一个协议族，它包括上百个具有不同功能且互为关联的协议，TCP和IP是保证数据完整传输的两个最基本的协议。
1. 网络接口层
2. 网际层
3. 传输层
4. 应用层

### 5层的体系结构
* 综合了OSI和TCP/IP的优点
1. 物理层
2. 数据链路层
3. 网络层
4. 传输层
5. 应用层

### OSI参考模型与TCP/IP参考模型区别
* 相同点：
    1. 分层
    2. 基于独立的协议栈的概念
    3. 可以实现异构网络互联
* 不同点：
    1. OSI定义三点：服务、协议、接口
    2. OSI先出现，参考模型先于协议发明，不偏向特定协议
    3. TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次

|    |  IOS/OSI参考模型  | TCP/IP模型   |
| --- | --- | --- |
| 网络层   |  无连接+面向连接  |  无连接  |
| 传输层   |  面向连接  | 无连接+面向连接    |

* 面向连接分为三个阶段，第一阶段是建立连接，在此阶段，发出一个建立连接的请求。只有在连接成功建立之后，才能开始数据传输，这是第二阶段。接着，当数据传输完毕，必须释放连接。而面向无连接没有这么多阶段，直接进行数据传输


## 复习题
1. “主机”和“端系统”之间有什么不同？列举几种不同类型的端系统。Web服务是一种端系统吗？
    * “主机”和“端系统”之间没有什么不同。“主机”和“端系统”这两个概念是可以互换的。不同类型的端系统：PC，Linux工作站
2. “协议”一词常被用于描述外交关系。维基百科是怎样描述外交协议的。
    * 维基百科:外交礼仪通常被描述为一套国际礼仪礼貌规则。这些久经考验的规则使它变得更容易国家和人民要共同生活和工作。协议的一部分一直是承认所有在场人员的等级地位。协议规则是基于基于文明的原则。
3. 列出6种接入技术。将它们分为分类为住宅接入，公司接入或广域无线接入。
    * 住宅接入：DSL（数字用户接入）、电缆、FTTH、拨号和卫星
    * 企业接入：以太网、WiFi
    * 广域网：3G、LTE、4G

# 二、物理层

## 2.1 物理层的基本概念

* 物理层解决如何在连接各种计算机的传输媒体上$\color{red}{传输数据比特流}$，而不是指具体的传输媒体
* 物理层的主要任务：确定与传输媒体接口有关的一些特性
    1. 机械特性：定义物理连接的特性，规定物理连接时所采用的规格、接口形状、引线数目、引脚数量和排列情况
    2. 电气特性：规定传输二进制位时，线路上信号的电压范围、阻抗匹配、传输速率和距离限制等
    3. 功能特性：指明某条线上出现的某一电平表示何种意义，接口部件的信号线的用途（描述一个物理层接口引脚处与高电平时的含义）
    4. 规程特性（过程特性）：定义各条物理线路的工作规程和时序关系



## 2.2 数据通信

通信的目的是传送消息

* 数据：传送消息的实体，通常是有意义的符号序列
* 信号：数据的电气/电磁的表现，是数据在传输过程中的$\color{red}{存在形式}$
    * 数字信号：代表消息的参数取值是离散的
    * 模拟信号：代表消息的参数取值是连续的
* 信源：产生和发送数据的源头
* 信宿：接受数据的终点
* 信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接受信道。

### 通信方式

从通信双方信息的交互方式看，可以有三种基本方式：

1. 单工通信：只有一个方向的通信而没有反方向的交互，仅需要$\color{red}{一条}$
2. 半双工通信：通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，需要$\color{red}{两条}$信道。
3. 全双工通信:通信双方可以同时发送和接收信息，也需要$\color{red}{两条}$信道

### 传输方式

* 串行传输：速度慢，费用低，适合远距离
* 并行传输：速度快，费用高，适合近距离



## 2.3 码元、波特、速率、带宽

* 码元：一个$\color{red}{固定时长}$和$\color{red}{信号波形}$，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为k进制码元，而该时长称为码元宽度。当码元的离散状态有M个时（M大于2），此时码元为M进制码元

    * 1码元可以携带多个比特的信息量。例如，在使用二进制编码时，只有两种不同的码元，一种代表0状态，另一种代表1状态

* 速率：也叫数据率，是指数据的$\color{red}{传输速率}$，表示单位时间内传输的数据量，可以用$\color{blue}{码元传输速率}$和$\color{blue}{信息传输速率}$表示

    * 码元传输速率：别名码元速率、波形速率、调制速率、符号速率等，它表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或信号变化的次数），单位是波特（Baud）。1波特表示数字通信系统每秒传输一个码元。这里的码元可以是多进制的，也可以是二进制的，但码元速率与进制数无关。

        > 1s传输多少个码元

    * 1Baud = 1 码元/s

    * 信息传输速率：别名信息速率、比特率，表示单位时间内数字通信系统传输的二进制码元个数（即比特数）单位是比特/秒

        > 1s传输多少个比特

    * 关系：若一个码元携带n bit的信息量，则M Baud的码元传输速率所对应的信息传输速率为$M × n      \ bit/s$

* 带宽：表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”，常用来表示网络的通信线路所能传输数据的能力。单位是b/s

例：某一数字通信系统传输的是四进制码元，4s传输了8000个码元，求系统的码元传输速率是多少？信息传输速率是多少？若另一通信系统传输的是十六进制码元，6s传输了7200个码元，求它的码元传输速率是多少？信息传输速率是多少？并指出哪个系统传输速率快

* 四进制下，码元传输速率为2000Baud，信息传输速率为4000b/s；十六进制下，码元传输速率为1200Baud，信息传输速率为4800b/s；十六进制更快



## 2.4 编码与调制

### 基带信号与宽带信号

信道上传送的信号：

* 基带信号：讲数字信号1和0直接压用两种不同的电压表示，再送到数字信道上去传输（基带传输）
    * 来自信源的信号，像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表大了要传输的信息的信号，比如说话的声波就是基带信号
* 宽带信号：将基带信号进行调制后形成的频分复用模拟信号，再传送到模拟信道上去传输（宽带传输）
    * 把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道）

在传输距离较近时，计算机网络采用基带传输方式，传输距离较远时，计算机网络采用宽带传输方式



### 编码与调制

* 数据 -> 数字信号：编码
* 数据 -> 信号模拟：调制





## 2.5 柰氏准则和香农定理

* 失真
* 影响失真的因素：
    1. 码元传输速率
    2. 信号传输距离
    3. 噪声干扰
    4. 传输媒体质量
* 码间串扰：接收端收到的信号波形失去了码元之间清晰界限的现象
    * 信道带宽：信道能通过的最高频率和最低频率之差
* 柰氏准则
    * 在理想低通（无噪声，带宽受限）条件下，为了避免码间串扰，极限码元传输速率为2W Baud，W是信道带宽，单位是Hz（只有在这两个公式中，带宽的单位是Hz）
    * 柰氏准则给出了码元传输速率的限制，但是并没有对信息传输速率给出限制
    * 由于码元的传输速率受柰氏准则的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法



# 三、数据链路层

## 3.1 数据链路层基本概念

结点：主机、路由器

链路：网络中两个结点之间的$\color{red}{物理通道}$，链路的传输介质主要有双绞线、光纤和微波。分为有线链路、无线链路

数据链路：网络中两个结点之间的$\color{red}{逻辑通道}$，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路

帧：链路层的协议数据单元，封装网络层数据报

数据链路层：负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报



## 3.2 数据链路层功能

数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠的传输到相邻节点的目标机网络层。其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路

1. 功能一：为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务
2. 功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）
3. 功能三：组帧
4. 功能四：流量控制
5. 功能五：差错控制



##  3.3 封装成帧与透明传输

* 封装成帧：在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束
    * 首部和尾部包含许多的控制信息，他们的一个重要作用：帧定界（确定帧的界限）
* 帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止
* 组帧的四种方法：
    1. 字符计数法
    2. 字符填充法
    3. 零比特填充法
    4. 违规编码法
* 透明传输：不管所传数据是什么样的比特组合，都应当能够在链路上传送。因此，链路层就“看不见”有什么妨碍传输数据的东西。当所传送数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使接收方不会将这样的错误误认为是某种控制信息。这样才能保证数据链路层的传输是透明的

### 3.3.1 字符计数法

帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数



### 3.3.2 字符填充法

